# generate dic for list_antibiotic_time and save as dic={}, ICUID is key for each patient, and list saves time
# Json file

import pandas as pd
import json
import numpy as np


file_path = '/Users/xuzhenxing/Documents/eicu-database-2.0/'
result_path = '/Users/xuzhenxing/Documents/eICU_AKI_Sepsis/'


def identify_antibiotic(antibiotic_list, row_drugordercancelled,row_drugname,row_routeadmin,drug_route_type_list):
    flag_antibiotic = 0 #  0 and 1 represent whether or the drug is antiobiotic, initial value is set as 0 for no antiobiotic

    if len(row_drugname) > 0:
        row_drugname = row_drugname.lower()

        if row_drugordercancelled == 'No':  # "No" represents that the records for this row are not cancelled in eICU database
            # row_routeadmin, remove the end space of the string
            # if row_routeadmin =='Inhaled (inhalation)                                                                                ':
            #     print('this is tesing Inhaled (inhalation) before remove',row_routeadmin)
            #     row_routeadmin = row_routeadmin.rstrip()
            #     print('this is tesing Inhaled (inhalation) after remove',row_routeadmin)
            # row_routeadmin = row_routeadmin.rstrip()

            if row_routeadmin in drug_route_type_list:  # keep route in  ['IV (intravenous)','IV', 'IV DRIP','IV BOLUS','IV - continuous infusion (intravenous)', 'PO (oral)','PO','ORAL']
                for i in antibiotic_list:
                    if i in row_drugname:
                        flag_antibiotic = 1
                        print('ssss')
                        break


    return flag_antibiotic

class NpEncoder(json.JSONEncoder):
    def default(self, obj):
        if isinstance(obj, np.integer):
            return int(obj)
        elif isinstance(obj, np.floating):
            return float(obj)
        elif isinstance(obj, np.ndarray):
            return obj.tolist()
        else:
            return super(NpEncoder, self).default(obj)









# read all patients and obtain their ID
patient = pd.read_csv(file_path+'patient.csv',index_col=False)
patient_ICU_ID = list(set(patient['patientunitstayid']))
print('len(patient_ICU_ID)',len(patient_ICU_ID))
medication = pd.read_csv(file_path+'medication.csv',index_col=False)
print('len(medication)',len(medication))
# obtained antibiotic items from microLab, provides 47 antibiotic items
antibiotic_eICU = ['clarithromycin', 'penicillin G', 'cefepime', 'cefotaxime', 'cefoxitin', 'cefazolin', 'erythromycin', 'cefuroxime', 'imipenem/cilastatin',
                   'amoxicillin', 'gentamicin', 'ertapenem', 'tetracycline', 'cefpodoxime', 'levofloxacin', 'trimethoprim/sulfamethoxazole', 'ticarcillin/clavulonic acid',
                   'ceftazidime', 'ceftizoxime', 'cefmetazole', 'piperacillin', 'chloramphenicol', 'linezolid', 'ticarcillin', 'ampicillin/sulbactam', 'aztreonam',
                   'azithromycin', 'ampicillin', 'meropenam', 'norfloxacin', 'tobramycin', 'amoxicillin/clavulonic acid', 'clindamycin', 'rifampin', 'moxifloxacin',
                   'piperacillin/tazobactam', 'streptomycin', 'vancomycin', 'ciprofloxacin', 'Other', 'ceftriaxone', 'nitrofurantoin', 'oxacillin', 'tigecycline', 'cefotetan', 'amikacin']

# we also refer to antiootic from MIMIC_III set which provides 125 antibiotic items.
# For patient 2101457, medicationid is 75846011,  VANCOCIN is in MIMIC_III list not in eICU microlab
antibiotic_MIMIC = ['bicillin l-a', 'rifadin', 'minocycline', 'vibra-tabs', 'clarithromycin', 'zinacef', 'eryc', 'monurol', 'cefepime', 'raniclor', 'trimethoprim', 'ceftibuten', 'factive',
                    'vibramycin', 'avidoxy', 'septra', 'proquin', 'sulfisoxazole', 'ery-tab', 'biaxin', 'chloramphenicol', 'myrac', 'rocephin', 'zmax', 'sulfamethoxazole', 'periostat',
                    'sulfatrim', 'cubicin', 'cefditoren', 'morgidox', 'ocudox', 'moxatag', 'macrobid', 'amikacin', 'bactocill', 'oxacillin', 'cefaclor', 'nafcillin sodium', 'ciprofloxacin',
                    'cefotetan', 'sulfadiazine', 'cedax', 'cefazolin', 'bactrim', 'panixine', 'cefadroxil', 'tazobactam', 'spectracef', 'noroxin', 'duricef', 'flagyl', 'streptomycin sulfate',
                    'pfizerpen', 'ceftin', 'cefotaxime', 'cefprozil', 'ofloxacin', 'solodyn', 'cleocin', 'macrodantin', 'amikin', 'cipro', 'omnicef', 'adoxa', 'dicloxacillin', 'azithromycin',
                    'vancomycin', 'dynacin', 'oracea', 'amoxicillin/clavulanate', 'rifampin', 'doxycycline', 'oraxyl', 'septra ds', 'timentin', 'ampicillin', 'vibativ', 'ala-tet', 'cefpodoxime',
                    'unasyn', 'azactam', 'metronidazole', 'amoxicillin', 'vantin', 'clavulanate', 'cayston', 'piperacillin', 'zosyn', 'cefdinir', 'erythrocin', 'nicazel doxy 30', 'minocin',
                    'zyvox', 'alodox', 'axetil', 'doryx', 'tobramycin', 'smz-tmp', 'nitrofurantoin', 'vancocin', 'cefoxitin', 'cefuroxime', 'augmentin', 'moxifloxacin', 'primsol', 'suprax',
                    'eryped', 'tetracycline', 'ceftazidime', 'penicillin', 'zithromax', 'cephalexin', 'monodox', 'pce dispertab', 'clindamycin', 'aztreonam', 'synercid', 'pediazole', 'tobi',
                    'mefoxin', 'avelox', 'tazicef', 'erythromycin', 'bethkis', 'maxipime']

antibiotic_item_list = list(set(antibiotic_eICU + antibiotic_MIMIC))
print('antibiotic_item_list',len(antibiotic_item_list))

# drug routeAdmit
# there are 872 route type, we choose same.
# routeadmin_items ['PEDIV', 'INTRAPERITONEAL', 'SC', 'Eyes (both)', 'IOCULAR', 'IV Push', 'Pacemaker', 'RT', 'Nasogastric tube', 'I-pleural', 'INHALATION', 'I-uteral', 'INJECT', 'NG or OG', 'RIGHT EYE', 'PERITONEAL C', 'Ear (Left)', 'IDERMAL', 'incision', 'VI', 'SQ CONTINUOU', 'Kit-Combo', 'Mouth Rinse', 'RT EYE', 'ZPYXVEND', 'PNB', 'TransUrethral', 'PO', 'PEDINH', 'ORATOP', 'Rect', 'INTRATRACH', 'OPHTHALMIC', 'NASL', 'Catheter', 'IPPB', 'EYES_BOTH', 'Peripheral Nerve', 'J Tube', 'EYE LEFT', 'ORAL GASTR', 'NS', 'Urth', 'PO/SL', 'IVDRIP', 'Subcut', 'Epidural', 'RADIV', 'Opht', 'MUCOUS MEMBRANE', 'IM Deltoid', 'LUMENS', 'nebu', 'INTRAMUSCULAR', 'INTRA-ARTERIAL', 'No route', 'DUODENAL', 'Topical (Top)', 'Nostril (Each)', 'COSIG IL', 'SWISH SPIT', 'INT', 'PEDTOP', 'EP', 'Oral Gastric Tube', 'TD', 'IAtc', 'IU', 'change to PO', 'Per G-Tube', 'J TUBE', 'CENTRAL IV', 'edtr', 'SUBCUTAN', 'Ear, Left', 'PD FLUID', 'Subcutan', 'IVD', 'SWISH', 'NG-TUBE', 'Submucosal', 'IM (injection)                                                                                      ', 'PEG-tube', 'BRONCHIAL WA', 'NASOGASTRI', 'Jtube', 'Flush', 'BOTH NOSTRILS', 'OTI', 'I-DERMALLY', 'NG', 'Eye, Right', 'LOK', 'LEFTEYE', 'INHL', 'INTRAVITREAL', 'TransMucosal', 'ANTIBIO LCK', 'TRANSDERMAL', 'BY MOUTH', 'Shunt', 'CHEST TUBE', 'Catheter lock', 'URETHRAL', 'UD', 'CVC', 'Injection', 'PEG TUBE', 'IL', 'Left Ear', 'DEEP IM', 'Left Nostril', 'INTRAMUSC', 'SL', 'RADINJ', 'NEBULIZATION', 'Intrabiliary', 'DT', 'AV graft/fis', 'I-dermal', 'G-Tube', 'Per G Tube', 'IOSS', 'DEVICE', 'PL', 'JPEG', 'IPERITNL', 'KIDSUBQ', 'INTRAVEN', 'PO or PEG', 'Intra-Catheter', 'Intrathecal', 'PER J TUBE', 'ORAL RINSE', 'EACH NOSTRIL', 'SUBCONJUNCTI', 'FLUSH', 'PEG-TUBE', 'NG-tube', 'Nostril (Right)', 'INTRAPLEUR', 'Inhale', 'NERVE BLOCK', 'IRRIGATION', 'INTRAARTER', 'RECTALLY', 'Intracavernosal', 'Ear (left)', 'Nasogastric', 'CO', 'EndoTRACHeal', 'Feeding', 'SubQ', 'EYE', 'J-Tube', 'VIA_TUBE', 'PERIPH IV', 'EXT', 'PEJ', 'ENDO', 'Peritoneal catheter', 'Machine prim', 'INH', 'IntraLumenal', 'Ear (Right)', 'PRIMARY IV', 'GTUBE', 'Orogastric', 'Intralesional', 'IC', 'Intrapleural', 'PER G-Tube', 'Nebulizer', 'SP', 'ID', 'Chew', 'ORAL', 'RT EAR', 'IVCOSIGN', 'Eye (left)', 'LEFT NARE', 'SW', 'SC/IV', 'Soak', 'LEFT EYE', 'SUB-Q', 'VAGINAL', 'INTRATHECL', 'Intraperiton', 'G/J tube', 'INTRA-ARTE', 'iv', 'Sublingual', 'IP', 'SWISH+SWAL', 'Intercatheter', 'ENDOSCOPY TU', 'Central Line', 'PEGT', 'IV CONT', 'Both eyes', 'SC/IM', 'O2 Aerosolization', 'EPI', 'EYE RIGHT', 'INFILTRATION', 'Intraureteral', 'NEB', 'BOTH NARES', 'EYE_RIGHT', 'IntraTHEcal', 'COSIG PO', 'IV112', 'INTRAVENTRIC', 'OT', 'IV INFUSE', 'PG', 'AU', 'Alternating Nares', '*IV/IM', 'Intranasal (nasal)                                                                                  ', 'Per NG tube', 'I-mucosal', 'TDERMAL', 'IV/IM/SC', 'EYE_LEFT', 'IDERM', 'VG', 'IC Dwell', 'per JG tube', 'IV Flush', 'IM VACC', 'IV BOLUS', 'CATH', 'PPN', 'TP', 'SUBQ VACC', 'MISCELL', 'I-articular', 'UroGenital', 'NASAL', 'MUC_MEMB', 'Intra-articular', 'Intravascula', 'Mucous membrane (topical mouth and throat) (mucous membrane)                                        ', 'LEFT FEMORAL', 'JTUB', 'PER TUBE', 'Both Eyes', 'InPl', 'TRANSLING.', 'NARE BOTH', 'Left Eye', 'Ostomy', 'IV/IM', 'PO/NGT', 'Gums', 'G_TUBE', 'Topical', 'Mouth/Throat', 'Oral swab', 'TRACHEAL TUB', 'ZIM', 'LVP', 'INHALE', 'FEEDING TUBE', 'IDRM', 'PO/IM', 'Topical (topical)                                                                                   ', 'PERCUTANEOUS', 'IVP', 'IM-V', 'Per J Tube', 'EPIDURAL', 'IntraTracheal', 'Transdermal', 'INTRALUMIN', 'Intrauteral', 'DEEPSUBCUT', 'Each affected nostril', 'LVF', 'Perineural', 'X', 'COSIG TD', 'SUBCUTANEOUS', 'I-ARTER', 'Nasogastric Tube', 'IntraVesical', 'PO or OG', 'IN', 'misc', 'Regional', 'SUBTENONS', 'PegTube', 'IM/IV', 'Per enteric tube (oral)                                                                             ', 'IH', 'Infiltration', 'Transurethral', 'NARE AFFEC', 'NGT', 'PERFUSION', 'Both Ears', 'CHEWED', 'ED', 'BOTH NOSTRIL', 'EAR BOTH', 'Alt Nostril', 'PO/NG', 'Mouthpiece', 'PEG', 'CBI', 'Right ear', 'BU', 'Perfusion', 'TRDRM', 'NJ', 'Miscellaneou', 'IPT', 'Other', '100 mg', 'KIDIV', 'Intra-catheter (arterial)', 'Subcutaneous (Subcutane)                                                                            ', 'INTRALESIO', 'IF', 'LEFT EAR', 'Cervical', 'PCA CONTINUOUS', 'Operative eye', 'INTRANASAL', 'Tracheal Tube', 'TU', 'MISC', 'PERI-ARTICUL', 'BUCL', 'IVB', 'SUB', 'Jejunostomy Tube', 'SUBCUTV', 'IV - brief infusion (intravenous)                                                                   ', 'Peripheral N', 'Intratrachea', 'Hemodialysis', 'OTIC BOTH', 'Transpyloric', 'INTRAVENOUS BOLUS', 'IRRIGATN', 'OD', 'EACH NARE', 'Left eye', 'ILEOSTOMY', 'Tube', 'TRANSDERMA', 'BUC', 'PER G TUBE', 'Inhaled                                                                                             ', 'DIALYSIS CAT', 'COSIG SUBQ', 'PO (oral)                                                                                           ', 'ORA', 'IVPUSH', 'Suck', 'IK', 'Intraocular', 'Intravesical', 'PER_TUBE', 'MT', 'NOTE', 'NERVEBLOCK', 'Apply externally', 'OPTH', 'Intrauterine', 'INTRAOCULA', 'INTRAVENOUS CONTINUOUS', 'INTRACATHETE', 'FT', 'Dobhoff Tube', 'PEDPO', 'TRANSDERM', 'Alt Nares', 'EPIDURAL Injection', 'IDrm', 'GTT', 'PROC IVP', 'Buccal', 'OG-tube', 'INF', 'SUB Q', 'IO', 'PROC IM', 'cv', 'AUR', 'IntraPeritoneal', 'RIGHT FEMORA', 'INTRADERM', 'Chewed', 'PR', 'PEDORATOP', 'OTIC LEFT', 'NERVE_BLOCK', 'IV DRIP', 'LInf', 'Right eye', 'Intratracheal', 'GT', 'PO or SL', 'Inhaled (inhalation)                                                                                ', 'G-TUBE', 'EAR_RIGHT', 'I-PERI', 'EACH EAR', 'ICI', 'ACCESS SITE', 'IV PUSH', 'INTRACARDIAC', 'SWISH/SWALLO', 'Right Ear', 'EAR', 'ESOPHAGEAL', 'CHEST', 'Top', 'RIGHT EAR', 'PEG Tube', 'ALT NARES', 'JOINT', 'Bucl', 'OPTH RIGHT', 'KIDCBI', 'I-osseus', 'Intradermal', 'TUBE FEED', 'NEBS', 'IntraVitreal', 'SeeAdmin', 'PGtube', 'subCUT', 'J-tube', 'MTHW', 'COSIG IM', 'SWISH/SPIT', 'CHEW', 'Dophoff Tube', 'G TUBE', 'SVN', 'MUCOUS MEM', 'ON TONGUE', 'ITD', 'RIGHT NARE', 'Inhl', 'Intranasal', 'BOTHEYES', 'Dialysis', 'JTUBE', 'TRACHEAL', 'INH/NEB', 'ARTERIAL', 'IS', 'MUCM', 'EYE BOTH', 'XX', 'TOPL', 'Transdermal (Transdermal)                                                                           ', 'Intraspinal', 'Per rectum (rectal)                                                                                 ', 'Eye (right)', 'Subcutaneous', 'Intra-arTERi', 'IV FLUSH', 'INFIL', 'BC', 'LAVAGE', 'Buccal/Sublingual (sublingual)                                                                      ', 'N/G tube', 'CI', 'Subcutaneous (injection)                                                                            ', 'SW_SPIT', 'ND', 'NG- NasoGast', 'CELLSAVER', 'INTRAVENOUS PUSH', 'PB', 'BOTH EARS', 'Dental', 'IT', 'IV - continuous infusion (intravenous)                                                              ', 'OTIC RIGHT', 'COSIG IV', 'GASTRIC TU', 'ARTICULAR', 'Irrigation', 'IPERITONEAL', 'SUBCUT', 'PEDOGT', 'Right Nostri', 'Nasojejunum Tube', 'AEROSOL', 'Ear (right)', 'IV - brief infusion (injection)                                                                     ', 'HICKMAN', 'NONE', 'IR', 'Otic', 'CRRT', 'Peritoneal D', 'IntraDermal', 'INTH', 'ng tube', 'Eye (Right)', 'G tube', 'ALTNOSTRIL', 'IMP', 'IA-Sheath-L', 'DIALYSATE', 'Miscellaneous', 'J TUBE BOLUS', 'OG- OralGast', 'Eyes (Each)', 'PD', 'INTRACAV', 'INTRADERMAL', 'Each Nare', 'Intraocular right eye', 'EYE_LT', 'LOZENGE', 'I-thecal', 'ng', 'INTRAVENOU', 'RTA', 'I-vesical', 'J-tube(Jeju)', 'INTRATHECA', 'RADPO', 'INLINE', 'NG_TUBE', 'In Vitro', 'EPID', 'Unknown', 'Caudal Block', 'EZPAP', 'REC', 'PO or G-tube', 'FIC', 'po', 'ADM', 'Gargle', 'INJ', 'Transmucosal', 'OU', 'IntraVENOUS', 'BLADDER INST', 'IV - continuous infusion (injection)                                                                ', 'CATHETER FLU', 'FTUBE', 'Intraosseous', 'BOTH EYES', 'PO or NG', 'INJECTABLE', 'Nebulization', 'IVADD', 'NGtube', 'NB', 'per G-tube', 'EPIDURAL Infusion', 'INTRADERMA', 'Rectal', 'IV                                                                                                  ', 'CATH LUMEN', 'TRANSDERM.', 'Vagl', 'IJ', 'NG-Tube', 'Intra-arTICu', 'Intraductal', 'IRRG', 'OTHER', 'Dwell', 'Epidur', 'MC', 'IVPB', 'Inj', 'per NJ tube', 'SYR', 'Oral', 'SQ', 'INHAL', 'Intra-urethral', 'Intracavitary', 'IX', 'HEMODIALYSIS', 'CHEW/SWALL', 'v sheath', 'MIS', 'INTRATRACHEA', 'Each Nostril', 'Caudal', 'Ophthalmic', 'NARES_BOTH', 'Local infiltration', 'InTr', 'Epid', 'Intravitreal', 'Inhalation', 'INDUCED SPUT', 'PEGTUBE', 'AO', 'Nostrils, alternating', 'Vaginal', 'INFILTRATE', 'I-tracheal', 'IVS', 'EACH EYE', 'Intradermal (Intraderm)                                                                             ', 'See Instruct', 'EA NOSTRIL', 'INTRALESION', 'INTRA-CATHET', 'Swish/Swllw', 'ORAL/TUBE', 'PEDAUR', 'Swish/Spit', 'APHERESIS', 'IM', 'PORT', 'Nasl', 'Intraventricular', 'JEJUNOSTOMY TUBE', 'Arterial', 'TUBE', 'Gtub', 'Insufflation', 'SW_SWALL', 'Ears (both)', 'BLAD', 'IntraThecal', 'TPN', 'INFILTRATI', 'NG/PO', 'Swish and Spit', 'IM/SQ', 'BOTH NOSTR', 'PER NG TUBE', 'Implant', 'PO_NG', 'LOC', 'Both Nostril', 'PCA', 'EYE_BOTH', 'ICOR', 'INTRAPLEURAL', 'Intravenous', 'SUBCUT/IM', 'EA EYE', 'Intraarterial', 'INTRAPERIT', 'HD FLUSH', 'TL', 'MOUTHWASH', 'BUCCAL', 'Nerve Cath', 'ICAR', 'IMPLANT', 'Gastric Tube (PEG)', 'IV', 'Does not apply', 'RADORAL', 'A/LINE', 'PO                                                                                                  ', 'BLOCK', 'PICC FLUSH', 'RC', 'JTub', 'Nostril (Left)', 'RECT', 'I-peritoneal', 'OGT', 'TLC', 'NG TUBE', 'G-tube', 'TOP', 'Oropharyngeal', 'Intracatheter', 'ENDOTRACHEAL', 'IRRIGATE', 'SUBLINGUAL', 'IM DELTOID', 'PER', 'STK', 'Nostril (Alt)', 'G-tube (Gast', 'GTUB', 'INTRA-ARTICULAR', 'Intracathete', 'PERINEURAL', 'SWAB MOUTH', 'IRR', '.SEE ORDER', 'ETTUBE', 'IntraLesional', 'IV or IM', 'IA', 'IV Sedation', 'IntraOsseous', 'IVDP', 'BN', 'SWISH+SPIT', 'oinj', 'Mucous Membrane', 'ICARDIAC', 'Eye (Left)', 'Each affected eye', 'OG', 'SWISH/SWAL', '1NOSTRIL', 'INJECTION', 'Feeding Tube', 'Right Eye', 'MUC_MEMBRANE', 'IV (intravenous)                                                                                    ', 'INTRAOSSEOUS', 'OG-TUBE', 'NGTUBE', 'DENTAL', 'Instill', 'IRRIG', 'Intra-arterial', 'IV Catheter', 'OTIC', 'ITHECAL', 'OPHT', 'G Tube', 'GASTROSTOMY TUBE', 'Misc', 'Intraperitoneal', 'Percutaneous feeding tube', 'TOPICAL', 'SUBQ', 'Endotracheal', 'Swab', 'ORAL MUCOSA', 'Tracheal Tub', 'Bladder Irri', 'INTRAVEN.', 'EYE_RT', 'INHALED', '.ROUTE', 'Right Inters', 'IV LOCK', 'ET', 'INTRAMUSCU', 'OPTH LEFT', 'RE', 'Route', 'Face mask', 'IV Piggyback', 'NAR_BOTH', 'HHN', 'Intramuscular', 'EX', 'LT EYE', 'Intracardiac', 'OPTH BOTH', 'Intraarticular', 'PICC', 'COSIG EPID', 'NEBULIZAT', 'TRND', 'Nostrils, each', 'Eye, Both', 'Gastrostomy Tube', 'EAR RIGHT', 'per OG tube', 'INTRAVENOUS PIGGY BACK', 'OP', 'SEE CHART', 'RECTAL', 'Opthalmic (opthalmic)                                                                               ', 'Subcutaneous                                                                                        ', 'NEBULIZER', 'INTRAVESIC', 'Intracoronary', 'IntraArterial', 'EYE AFFECT', 'Ifil', 'J tube', 'Urethral', 'Nasal', 'INTRA-LESION', 'INTRA-MUSCULAR', 'Chest Tube', 'Ear, Right', 'IntraArticular', 'IV/SUBCUT', 'Swish & Swallow', 'VA', 'IM (intramuscular)                                                                                  ', 'Intrabladder', 'INTRASPINAL', 'VAG', 'OPH', 'IntraMUSCULAR', 'MISCELL.', 'NG Tube', 'COSIG INH', 'DIAL', 'NASOGASTRIC TUBE', 'SC ABDOMEN', 'J-TUBE', 'Ears (Each)', 'I-DERMAL', 'IntraPleural', 'oirr', 'JT', 'OS', 'IPL', 'Instillation', 'ETT', 'Both ears', 'KIDOGT', 'MM', 'INTRACORONAR', 'IMV', 'Ear, Both', 'I-ARTIC', 'Miscellaneous (medical supplies non-drugs) (Miscellaneous)                                          ', 'IA-Sheath-R', 'Swish', 'Buccal/Sublingual (buccal)                                                                          ', 'SPINAL', 'Each affected ear', 'VE', 'DIALYSIS', 'TF', 'Cath', 'NG tube', 'INTRAOSSEO', 'SS', 'Device', 'DOBHOFF', 'Via Sheath', 'IART', 'IntraOcular', 'UR', 'Eye, Left', 'RTL', 'UROGEN', 'I-ocular', 'Intraoperative', 'Left ear', 'RADREC', 'IV (injection)                                                                                      ', 'SUBL', 'PIC/PICC', 'Swish and Swallow', 'post-pyloric', 'IM or IV', 'PEDCBI', 'per NGT', 'Gtube', 'Operative Ey', 'Oral Inhalation', 'EPIDURL', 'Gastric Tube', 'INTRAVENOUS', 'NAR1', 'OPHTH', 'PMX', 'IArt', 'NAS', 'DE', 'zz']

drug_route_type = ['PEDIV', 'INTRAPERITONEAL', 'SC', 'Eyes (both)', 'IOCULAR', 'IV Push', 'Pacemaker', 'RT', 'Nasogastric tube', 'I-pleural', 'INHALATION', 'I-uteral', 'INJECT', 'NG or OG', 'RIGHT EYE', 'PERITONEAL C', 'Ear (Left)', 'IDERMAL', 'incision', 'VI', 'SQ CONTINUOU', 'Kit-Combo', 'Mouth Rinse', 'RT EYE', 'ZPYXVEND', 'PNB', 'TransUrethral', 'PO', 'PEDINH', 'ORATOP', 'Rect', 'INTRATRACH', 'OPHTHALMIC', 'NASL', 'Catheter', 'IPPB', 'EYES_BOTH', 'Peripheral Nerve', 'J Tube', 'EYE LEFT', 'ORAL GASTR', 'NS', 'Urth', 'PO/SL', 'IVDRIP', 'Subcut', 'Epidural', 'RADIV', 'Opht', 'MUCOUS MEMBRANE', 'IM Deltoid', 'LUMENS', 'nebu', 'INTRAMUSCULAR', 'INTRA-ARTERIAL', 'No route', 'DUODENAL', 'Topical (Top)', 'Nostril (Each)', 'COSIG IL', 'SWISH SPIT', 'INT', 'PEDTOP', 'EP', 'Oral Gastric Tube', 'TD', 'IAtc', 'IU', 'change to PO', 'Per G-Tube', 'J TUBE', 'CENTRAL IV', 'edtr', 'SUBCUTAN', 'Ear, Left', 'PD FLUID', 'Subcutan', 'IVD', 'SWISH', 'NG-TUBE', 'Submucosal', 'IM (injection)                                                                                      ', 'PEG-tube', 'BRONCHIAL WA', 'NASOGASTRI', 'Jtube', 'Flush', 'BOTH NOSTRILS', 'OTI', 'I-DERMALLY', 'NG', 'Eye, Right', 'LOK', 'LEFTEYE', 'INHL', 'INTRAVITREAL', 'TransMucosal', 'ANTIBIO LCK', 'TRANSDERMAL', 'BY MOUTH', 'Shunt', 'CHEST TUBE', 'Catheter lock', 'URETHRAL', 'UD', 'CVC', 'Injection', 'PEG TUBE', 'IL', 'Left Ear', 'DEEP IM', 'Left Nostril', 'INTRAMUSC', 'SL', 'RADINJ', 'NEBULIZATION', 'Intrabiliary', 'DT', 'AV graft/fis', 'I-dermal', 'G-Tube', 'Per G Tube', 'IOSS', 'DEVICE', 'PL', 'JPEG', 'IPERITNL', 'KIDSUBQ', 'INTRAVEN', 'PO or PEG', 'Intra-Catheter', 'Intrathecal', 'PER J TUBE', 'ORAL RINSE', 'EACH NOSTRIL', 'SUBCONJUNCTI', 'FLUSH', 'PEG-TUBE', 'NG-tube', 'Nostril (Right)', 'INTRAPLEUR', 'Inhale', 'NERVE BLOCK', 'IRRIGATION', 'INTRAARTER', 'RECTALLY', 'Intracavernosal', 'Ear (left)', 'Nasogastric', 'CO', 'EndoTRACHeal', 'Feeding', 'SubQ', 'EYE', 'J-Tube', 'VIA_TUBE', 'PERIPH IV', 'EXT', 'PEJ', 'ENDO', 'Peritoneal catheter', 'Machine prim', 'INH', 'IntraLumenal', 'Ear (Right)', 'PRIMARY IV', 'GTUBE', 'Orogastric', 'Intralesional', 'IC', 'Intrapleural', 'PER G-Tube', 'Nebulizer', 'SP', 'ID', 'Chew', 'ORAL', 'RT EAR', 'IVCOSIGN', 'Eye (left)', 'LEFT NARE', 'SW', 'SC/IV', 'Soak', 'LEFT EYE', 'SUB-Q', 'VAGINAL', 'INTRATHECL', 'Intraperiton', 'G/J tube', 'INTRA-ARTE', 'iv', 'Sublingual', 'IP', 'SWISH+SWAL', 'Intercatheter', 'ENDOSCOPY TU', 'Central Line', 'PEGT', 'IV CONT', 'Both eyes', 'SC/IM', 'O2 Aerosolization', 'EPI', 'EYE RIGHT', 'INFILTRATION', 'Intraureteral', 'NEB', 'BOTH NARES', 'EYE_RIGHT', 'IntraTHEcal', 'COSIG PO', 'IV112', 'INTRAVENTRIC', 'OT', 'IV INFUSE', 'PG', 'AU', 'Alternating Nares', '*IV/IM', 'Intranasal (nasal)                                                                                  ', 'Per NG tube', 'I-mucosal', 'TDERMAL', 'IV/IM/SC', 'EYE_LEFT', 'IDERM', 'VG', 'IC Dwell', 'per JG tube', 'IV Flush', 'IM VACC', 'IV BOLUS', 'CATH', 'PPN', 'TP', 'SUBQ VACC', 'MISCELL', 'I-articular', 'UroGenital', 'NASAL', 'MUC_MEMB', 'Intra-articular', 'Intravascula', 'Mucous membrane (topical mouth and throat) (mucous membrane)                                        ', 'LEFT FEMORAL', 'JTUB', 'PER TUBE', 'Both Eyes', 'InPl', 'TRANSLING.', 'NARE BOTH', 'Left Eye', 'Ostomy', 'IV/IM', 'PO/NGT', 'Gums', 'G_TUBE', 'Topical', 'Mouth/Throat', 'Oral swab', 'TRACHEAL TUB', 'ZIM', 'LVP', 'INHALE', 'FEEDING TUBE', 'IDRM', 'PO/IM', 'Topical (topical)                                                                                   ', 'PERCUTANEOUS', 'IVP', 'IM-V', 'Per J Tube', 'EPIDURAL', 'IntraTracheal', 'Transdermal', 'INTRALUMIN', 'Intrauteral', 'DEEPSUBCUT', 'Each affected nostril', 'LVF', 'Perineural', 'X', 'COSIG TD', 'SUBCUTANEOUS', 'I-ARTER', 'Nasogastric Tube', 'IntraVesical', 'PO or OG', 'IN', 'misc', 'Regional', 'SUBTENONS', 'PegTube', 'IM/IV', 'Per enteric tube (oral)                                                                             ', 'IH', 'Infiltration', 'Transurethral', 'NARE AFFEC', 'NGT', 'PERFUSION', 'Both Ears', 'CHEWED', 'ED', 'BOTH NOSTRIL', 'EAR BOTH', 'Alt Nostril', 'PO/NG', 'Mouthpiece', 'PEG', 'CBI', 'Right ear', 'BU', 'Perfusion', 'TRDRM', 'NJ', 'Miscellaneou', 'IPT', 'Other', '100 mg', 'KIDIV', 'Intra-catheter (arterial)', 'Subcutaneous (Subcutane)                                                                            ', 'INTRALESIO', 'IF', 'LEFT EAR', 'Cervical', 'PCA CONTINUOUS', 'Operative eye', 'INTRANASAL', 'Tracheal Tube', 'TU', 'MISC', 'PERI-ARTICUL', 'BUCL', 'IVB', 'SUB', 'Jejunostomy Tube', 'SUBCUTV', 'IV - brief infusion (intravenous)                                                                   ', 'Peripheral N', 'Intratrachea', 'Hemodialysis', 'OTIC BOTH', 'Transpyloric', 'INTRAVENOUS BOLUS', 'IRRIGATN', 'OD', 'EACH NARE', 'Left eye', 'ILEOSTOMY', 'Tube', 'TRANSDERMA', 'BUC', 'PER G TUBE', 'Inhaled                                                                                             ', 'DIALYSIS CAT', 'COSIG SUBQ', 'PO (oral)                                                                                           ', 'ORA', 'IVPUSH', 'Suck', 'IK', 'Intraocular', 'Intravesical', 'PER_TUBE', 'MT', 'NOTE', 'NERVEBLOCK', 'Apply externally', 'OPTH', 'Intrauterine', 'INTRAOCULA', 'INTRAVENOUS CONTINUOUS', 'INTRACATHETE', 'FT', 'Dobhoff Tube', 'PEDPO', 'TRANSDERM', 'Alt Nares', 'EPIDURAL Injection', 'IDrm', 'GTT', 'PROC IVP', 'Buccal', 'OG-tube', 'INF', 'SUB Q', 'IO', 'PROC IM', 'cv', 'AUR', 'IntraPeritoneal', 'RIGHT FEMORA', 'INTRADERM', 'Chewed', 'PR', 'PEDORATOP', 'OTIC LEFT', 'NERVE_BLOCK', 'IV DRIP', 'LInf', 'Right eye', 'Intratracheal', 'GT', 'PO or SL', 'Inhaled (inhalation)                                                                                ', 'G-TUBE', 'EAR_RIGHT', 'I-PERI', 'EACH EAR', 'ICI', 'ACCESS SITE', 'IV PUSH', 'INTRACARDIAC', 'SWISH/SWALLO', 'Right Ear', 'EAR', 'ESOPHAGEAL', 'CHEST', 'Top', 'RIGHT EAR', 'PEG Tube', 'ALT NARES', 'JOINT', 'Bucl', 'OPTH RIGHT', 'KIDCBI', 'I-osseus', 'Intradermal', 'TUBE FEED', 'NEBS', 'IntraVitreal', 'SeeAdmin', 'PGtube', 'subCUT', 'J-tube', 'MTHW', 'COSIG IM', 'SWISH/SPIT', 'CHEW', 'Dophoff Tube', 'G TUBE', 'SVN', 'MUCOUS MEM', 'ON TONGUE', 'ITD', 'RIGHT NARE', 'Inhl', 'Intranasal', 'BOTHEYES', 'Dialysis', 'JTUBE', 'TRACHEAL', 'INH/NEB', 'ARTERIAL', 'IS', 'MUCM', 'EYE BOTH', 'XX', 'TOPL', 'Transdermal (Transdermal)                                                                           ', 'Intraspinal', 'Per rectum (rectal)                                                                                 ', 'Eye (right)', 'Subcutaneous', 'Intra-arTERi', 'IV FLUSH', 'INFIL', 'BC', 'LAVAGE', 'Buccal/Sublingual (sublingual)                                                                      ', 'N/G tube', 'CI', 'Subcutaneous (injection)                                                                            ', 'SW_SPIT', 'ND', 'NG- NasoGast', 'CELLSAVER', 'INTRAVENOUS PUSH', 'PB', 'BOTH EARS', 'Dental', 'IT', 'IV - continuous infusion (intravenous)                                                              ', 'OTIC RIGHT', 'COSIG IV', 'GASTRIC TU', 'ARTICULAR', 'Irrigation', 'IPERITONEAL', 'SUBCUT', 'PEDOGT', 'Right Nostri', 'Nasojejunum Tube', 'AEROSOL', 'Ear (right)', 'IV - brief infusion (injection)                                                                     ', 'HICKMAN', 'NONE', 'IR', 'Otic', 'CRRT', 'Peritoneal D', 'IntraDermal', 'INTH', 'ng tube', 'Eye (Right)', 'G tube', 'ALTNOSTRIL', 'IMP', 'IA-Sheath-L', 'DIALYSATE', 'Miscellaneous', 'J TUBE BOLUS', 'OG- OralGast', 'Eyes (Each)', 'PD', 'INTRACAV', 'INTRADERMAL', 'Each Nare', 'Intraocular right eye', 'EYE_LT', 'LOZENGE', 'I-thecal', 'ng', 'INTRAVENOU', 'RTA', 'I-vesical', 'J-tube(Jeju)', 'INTRATHECA', 'RADPO', 'INLINE', 'NG_TUBE', 'In Vitro', 'EPID', 'Unknown', 'Caudal Block', 'EZPAP', 'REC', 'PO or G-tube', 'FIC', 'po', 'ADM', 'Gargle', 'INJ', 'Transmucosal', 'OU', 'IntraVENOUS', 'BLADDER INST', 'IV - continuous infusion (injection)                                                                ', 'CATHETER FLU', 'FTUBE', 'Intraosseous', 'BOTH EYES', 'PO or NG', 'INJECTABLE', 'Nebulization', 'IVADD', 'NGtube', 'NB', 'per G-tube', 'EPIDURAL Infusion', 'INTRADERMA', 'Rectal', 'IV                                                                                                  ', 'CATH LUMEN', 'TRANSDERM.', 'Vagl', 'IJ', 'NG-Tube', 'Intra-arTICu', 'Intraductal', 'IRRG', 'OTHER', 'Dwell', 'Epidur', 'MC', 'IVPB', 'Inj', 'per NJ tube', 'SYR', 'Oral', 'SQ', 'INHAL', 'Intra-urethral', 'Intracavitary', 'IX', 'HEMODIALYSIS', 'CHEW/SWALL', 'v sheath', 'MIS', 'INTRATRACHEA', 'Each Nostril', 'Caudal', 'Ophthalmic', 'NARES_BOTH', 'Local infiltration', 'InTr', 'Epid', 'Intravitreal', 'Inhalation', 'INDUCED SPUT', 'PEGTUBE', 'AO', 'Nostrils, alternating', 'Vaginal', 'INFILTRATE', 'I-tracheal', 'IVS', 'EACH EYE', 'Intradermal (Intraderm)                                                                             ', 'See Instruct', 'EA NOSTRIL', 'INTRALESION', 'INTRA-CATHET', 'Swish/Swllw', 'ORAL/TUBE', 'PEDAUR', 'Swish/Spit', 'APHERESIS', 'IM', 'PORT', 'Nasl', 'Intraventricular', 'JEJUNOSTOMY TUBE', 'Arterial', 'TUBE', 'Gtub', 'Insufflation', 'SW_SWALL', 'Ears (both)', 'BLAD', 'IntraThecal', 'TPN', 'INFILTRATI', 'NG/PO', 'Swish and Spit', 'IM/SQ', 'BOTH NOSTR', 'PER NG TUBE', 'Implant', 'PO_NG', 'LOC', 'Both Nostril', 'PCA', 'EYE_BOTH', 'ICOR', 'INTRAPLEURAL', 'Intravenous', 'SUBCUT/IM', 'EA EYE', 'Intraarterial', 'INTRAPERIT', 'HD FLUSH', 'TL', 'MOUTHWASH', 'BUCCAL', 'Nerve Cath', 'ICAR', 'IMPLANT', 'Gastric Tube (PEG)', 'IV', 'Does not apply', 'RADORAL', 'A/LINE', 'PO                                                                                                  ', 'BLOCK', 'PICC FLUSH', 'RC', 'JTub', 'Nostril (Left)', 'RECT', 'I-peritoneal', 'OGT', 'TLC', 'NG TUBE', 'G-tube', 'TOP', 'Oropharyngeal', 'Intracatheter', 'ENDOTRACHEAL', 'IRRIGATE', 'SUBLINGUAL', 'IM DELTOID', 'PER', 'STK', 'Nostril (Alt)', 'G-tube (Gast', 'GTUB', 'INTRA-ARTICULAR', 'Intracathete', 'PERINEURAL', 'SWAB MOUTH', 'IRR', '.SEE ORDER', 'ETTUBE', 'IntraLesional', 'IV or IM', 'IA', 'IV Sedation', 'IntraOsseous', 'IVDP', 'BN', 'SWISH+SPIT', 'oinj', 'Mucous Membrane', 'ICARDIAC', 'Eye (Left)', 'Each affected eye', 'OG', 'SWISH/SWAL', '1NOSTRIL', 'INJECTION', 'Feeding Tube', 'Right Eye', 'MUC_MEMBRANE', 'IV (intravenous)                                                                                    ', 'INTRAOSSEOUS', 'OG-TUBE', 'NGTUBE', 'DENTAL', 'Instill', 'IRRIG', 'Intra-arterial', 'IV Catheter', 'OTIC', 'ITHECAL', 'OPHT', 'G Tube', 'GASTROSTOMY TUBE', 'Misc', 'Intraperitoneal', 'Percutaneous feeding tube', 'TOPICAL', 'SUBQ', 'Endotracheal', 'Swab', 'ORAL MUCOSA', 'Tracheal Tub', 'Bladder Irri', 'INTRAVEN.', 'EYE_RT', 'INHALED', '.ROUTE', 'Right Inters', 'IV LOCK', 'ET', 'INTRAMUSCU', 'OPTH LEFT', 'RE', 'Route', 'Face mask', 'IV Piggyback', 'NAR_BOTH', 'HHN', 'Intramuscular', 'EX', 'LT EYE', 'Intracardiac', 'OPTH BOTH', 'Intraarticular', 'PICC', 'COSIG EPID', 'NEBULIZAT', 'TRND', 'Nostrils, each', 'Eye, Both', 'Gastrostomy Tube', 'EAR RIGHT', 'per OG tube', 'INTRAVENOUS PIGGY BACK', 'OP', 'SEE CHART', 'RECTAL', 'Opthalmic (opthalmic)                                                                               ', 'Subcutaneous                                                                                        ', 'NEBULIZER', 'INTRAVESIC', 'Intracoronary', 'IntraArterial', 'EYE AFFECT', 'Ifil', 'J tube', 'Urethral', 'Nasal', 'INTRA-LESION', 'INTRA-MUSCULAR', 'Chest Tube', 'Ear, Right', 'IntraArticular', 'IV/SUBCUT', 'Swish & Swallow', 'VA', 'IM (intramuscular)                                                                                  ', 'Intrabladder', 'INTRASPINAL', 'VAG', 'OPH', 'IntraMUSCULAR', 'MISCELL.', 'NG Tube', 'COSIG INH', 'DIAL', 'NASOGASTRIC TUBE', 'SC ABDOMEN', 'J-TUBE', 'Ears (Each)', 'I-DERMAL', 'IntraPleural', 'oirr', 'JT', 'OS', 'IPL', 'Instillation', 'ETT', 'Both ears', 'KIDOGT', 'MM', 'INTRACORONAR', 'IMV', 'Ear, Both', 'I-ARTIC', 'Miscellaneous (medical supplies non-drugs) (Miscellaneous)                                          ', 'IA-Sheath-R', 'Swish', 'Buccal/Sublingual (buccal)                                                                          ', 'SPINAL', 'Each affected ear', 'VE', 'DIALYSIS', 'TF', 'Cath', 'NG tube', 'INTRAOSSEO', 'SS', 'Device', 'DOBHOFF', 'Via Sheath', 'IART', 'IntraOcular', 'UR', 'Eye, Left', 'RTL', 'UROGEN', 'I-ocular', 'Intraoperative', 'Left ear', 'RADREC', 'IV (injection)                                                                                      ', 'SUBL', 'PIC/PICC', 'Swish and Swallow', 'post-pyloric', 'IM or IV', 'PEDCBI', 'per NGT', 'Gtube', 'Operative Ey', 'Oral Inhalation', 'EPIDURL', 'Gastric Tube', 'INTRAVENOUS', 'NAR1', 'OPHTH', 'PMX', 'IArt', 'NAS', 'DE', 'zz']

# drug_route_type = ['IV (intravenous)','INTRAVENOUS','IV - brief infusion (intravenous)','IntraVENOUS','Intravenous','Injection',
#                    'IV', 'IV Push','IV PUSH','IVPUSH','IV DRIP','IVDRIP','IV BOLUS','IV - continuous infusion (intravenous)','IV - continuous infusion (injection)', 'PO (oral)','PO','po','ORAL','Oral']





# save all patients' antibiotic for all patient in dic
antibiotic_time = {}
count = 0
for i in patient_ICU_ID:
    count = count + 1
    print('count',count)

    each_p_ID = i
    print('patient_ICU_ID',each_p_ID)
    each_p_inf = medication.loc[medication['patientunitstayid']==i]

    # each_p_inf.to_csv(result_path+'testing_antibiotic/'+str(each_p_ID)+'.csv',index=False)

    # delete empty rows in 'drugname' and 'routeadmin',column
    # each_p_inf = each_p_inf[each_p_inf['drugname'].notna()]
    each_p_inf = each_p_inf.dropna(subset=['drugname', 'routeadmin'])


    # antibiotics must have been administered for at least 72 consecutive hours. 72*60 = 4320 mins
    # each_p_inf = each_p_inf[abs(each_p_inf["drugstopoffset"] - each_p_inf["drugstartoffset"]) > 4320]

    # save all antibiotic time for each patient
    each_p_antibiotic_time = []

    if len(each_p_inf)>0:
        # reset index for each_p_inf from 0 to len(each_p_inf)-1
        each_p_inf = each_p_inf.reset_index(drop=True)
        for j in range(len(each_p_inf)):
            # drug order time (mins)
            each_row_drugorderoffset = each_p_inf.loc[j,'drugorderoffset']
            # drug cancell ?
            each_row_drugordercancelled = each_p_inf.loc[j,'drugordercancelled']
            # drug name
            each_row_drugname = each_p_inf.loc[j,'drugname']
            each_row_medicationid = each_p_inf.loc[j,'medicationid']
            # print('each_p_ID,each_row_drugname,each_row_medicationid',each_p_ID,each_row_drugname,each_row_medicationid)
            # drug route
            each_row_routeadmin = each_p_inf.loc[j,'routeadmin']

            each_row_antibiotic_flag = identify_antibiotic(antibiotic_item_list,each_row_drugordercancelled,each_row_drugname,each_row_routeadmin,drug_route_type)

            if each_row_antibiotic_flag ==1:
                each_p_antibiotic_time.append(each_row_drugorderoffset)
    # save one patient's  antibiotic time
    antibiotic_time[str(each_p_ID)] = each_p_antibiotic_time
    #
    # if count==5000:
    #     print('tem_stop')
    #     break

# save dic file
with open(result_path + "list_antibiotic_time.json", "w") as outfile:
    json.dump(antibiotic_time, outfile,cls=NpEncoder,indent=4)

print('it is over.')




